(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function o(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=o(n);fetch(n.href,s)}})();const c={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"54192aef-a51b-4a5a-b397-a310d1cef54f","Content-Type":"application/json"}},d=e=>e.ok?e.json():Promise.reject({status:e.status,message:e.status===403?"Недостаточно прав для выполнения операции":`Ошибка: ${e.status}`}),ee=()=>fetch(`${c.baseUrl}/users/me`,{headers:c.headers}).then(d),W=()=>fetch(`${c.baseUrl}/cards`,{headers:c.headers}).then(d),te=({name:e,about:t})=>fetch(`${c.baseUrl}/users/me`,{method:"PATCH",headers:c.headers,body:JSON.stringify({name:e,about:t})}).then(d),oe=({avatar:e})=>fetch(`${c.baseUrl}/users/me/avatar`,{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:e})}).then(d),re=({name:e,link:t})=>fetch(`${c.baseUrl}/cards`,{method:"POST",headers:c.headers,body:JSON.stringify({name:e,link:t})}).then(d),ne=e=>fetch(`${c.baseUrl}/cards/${e}`,{method:"DELETE",headers:c.headers}).then(d),se=(e,t)=>fetch(`${c.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:c.headers}).then(d),j=(e,t,o,r,n)=>{se(e,r).then(s=>{s.likes.some(_=>_._id===n)?t.classList.add("card__like-button_is-active"):t.classList.remove("card__like-button_is-active"),o&&(o.textContent=s.likes.length)}).catch(()=>{})},ce=(e,t)=>ne(e).then(()=>{t.remove()}).catch(o=>{throw o}),ie=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),J=(e,t,{onPreviewPicture:o,onLikeIcon:r,onDeleteCard:n,onInfoClick:s})=>{const i=ie(),_=i.querySelector(".card__like-button"),L=i.querySelector(".card__like-count"),U=i.querySelector(".card__control-button_type_delete"),Z=i.querySelector(".card__control-button_type_info"),k=i.querySelector(".card__image");if(k.src=e.link,k.alt=e.name,i.querySelector(".card__title").textContent=e.name,e.owner&&e.owner._id&&e.owner._id===t?n&&U.addEventListener("click",()=>n(e._id,i)):U.remove(),s&&Z.addEventListener("click",()=>s(e._id)),e.likes&&Array.isArray(e.likes)?(L.textContent=e.likes.length,e.likes.some(g=>g._id===t)&&_.classList.add("card__like-button_is-active")):L.textContent=0,r){const $=e.likes&&e.likes.some(g=>g._id===t);_.addEventListener("click",()=>r(e._id,_,L,$,t))}return o&&k.addEventListener("click",()=>o({name:e.name,link:e.link})),i},V=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");a(t)}},f=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",V)},a=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",V)},le=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{a(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&a(e)})},ae=(e,t,o,r)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.add(r.inputErrorClass),n&&(n.textContent=o,n.classList.add(r.errorClass))},H=(e,t,o)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),r&&(r.textContent="",r.classList.remove(o.errorClass))},ue=(e,t,o)=>{if(t.validity.valid)H(e,t,o);else{let r=t.validationMessage;t.hasAttribute("data-error-message")&&t.validity.patternMismatch&&(r=t.getAttribute("data-error-message")),ae(e,t,r,o)}},de=e=>Array.from(e).some(t=>!t.validity.valid),pe=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.disabled=!0},me=(e,t)=>{e.classList.remove(t.inactiveButtonClass),e.disabled=!1},E=(e,t,o)=>{t&&(de(e)?pe(t,o):me(t,o))},fe=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);E(o,r,t),o.forEach(n=>{n.addEventListener("input",function(){ue(e,n,t),E(o,r,t)})})},_e=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{fe(o,e)})},x=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);o.forEach(n=>{H(e,n,t)}),r&&E(o,r,t)},R=document.querySelector(".places__list"),I=document.querySelector(".popup_type_edit"),p=I.querySelector(".popup__form"),z=p.querySelector(".popup__input_type_name"),K=p.querySelector(".popup__input_type_description"),w=document.querySelector(".popup_type_new-card"),u=w.querySelector(".popup__form"),ye=u.querySelector(".popup__input_type_card-name"),he=u.querySelector(".popup__input_type_url"),B=document.querySelector(".popup_type_image"),D=B.querySelector(".popup__image"),Se=B.querySelector(".popup__caption"),ve=document.querySelector(".profile__edit-button"),Ce=document.querySelector(".profile__add-button"),A=document.querySelector(".profile__title"),P=document.querySelector(".profile__description"),T=document.querySelector(".profile__image"),M=document.querySelector(".popup_type_edit-avatar"),m=M.querySelector(".popup__form"),N=m.querySelector(".popup__input"),F=document.querySelector(".popup_type_remove-card"),G=F.querySelector(".popup__form"),y=document.querySelector(".popup_type_info");y.querySelector(".popup__title");const l=y.querySelector(".popup__info"),O=y.querySelector(".popup__text"),h=y.querySelector(".popup__list");let v=null,C=null;const q={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},be=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),S=(e,t)=>{const r=document.getElementById("popup-info-definition-template").content.querySelector(".popup__info-item").cloneNode(!0);return r.querySelector(".popup__info-term").textContent=e,r.querySelector(".popup__info-description").textContent=t,r},qe=e=>{const o=document.getElementById("popup-info-user-preview-template").content.querySelector(".popup__list-item").cloneNode(!0);return o.textContent=e.name,o},Q=e=>{W().then(t=>{const o=t.find(n=>n._id===e);if(!o)return;for(;l.firstChild;)l.removeChild(l.firstChild);for(;h.firstChild;)h.removeChild(h.firstChild);l.append(S("Описание:",o.name)),l.append(S("Дата создания:",be(new Date(o.createdAt)))),o.owner&&l.append(S("Владелец:",o.owner.name));const r=o.likes?o.likes.length:0;l.append(S("Количество лайков:",r.toString())),o.likes&&o.likes.length>0?(O.textContent="Лайкнули:",o.likes.forEach(n=>{h.append(qe(n))})):O.textContent="Лайкнули:",f(y)}).catch(()=>{})},X=({name:e,link:t})=>{D.src=t,D.alt=e,Se.textContent=e,f(B)},Le=e=>{e.preventDefault();const t=p.querySelector(".popup__button"),o=t.textContent;t.textContent="Сохранение...",t.disabled=!0,te({name:z.value,about:K.value}).then(r=>{A.textContent=r.name,P.textContent=r.about,p.reset(),a(I)}).catch(()=>{}).finally(()=>{t.textContent=o,t.disabled=!1})},ke=e=>{if(e.preventDefault(),!N.value)return;const t=m.querySelector(".popup__button"),o=t.textContent;t.textContent="Сохранение...",t.disabled=!0,oe({avatar:N.value}).then(r=>{T.style.backgroundImage=`url(${r.avatar})`,m.reset(),a(M)}).catch(()=>{}).finally(()=>{t.textContent=o,t.disabled=!1})},ge=e=>{if(e.preventDefault(),!b)return;const t=u.querySelector(".popup__button"),o=t.textContent;t.textContent="Создание...",t.disabled=!0,re({name:ye.value,link:he.value}).then(r=>{R.prepend(J(r,b,{onPreviewPicture:X,onLikeIcon:j,onDeleteCard:Y,onInfoClick:Q})),u.reset(),a(w)}).catch(()=>{}).finally(()=>{t.textContent=o,t.disabled=!1})},Y=(e,t)=>{v=e,C=t,f(F)},Ee=e=>{if(e.preventDefault(),!v||!C)return;const t=G.querySelector(".popup__button"),o=t.textContent;t.textContent="Удаление...",t.disabled=!0,ce(v,C).then(()=>{a(F),v=null,C=null}).catch(()=>{}).finally(()=>{t.textContent=o,t.disabled=!1})};p.addEventListener("submit",Le);u.addEventListener("submit",ge);m.addEventListener("submit",ke);G.addEventListener("submit",Ee);ve.addEventListener("click",()=>{z.value=A.textContent,K.value=P.textContent,x(p,q),f(I)});T.addEventListener("click",()=>{m.reset(),x(m,q),f(M)});Ce.addEventListener("click",()=>{u.reset(),x(u,q),f(w)});const xe=document.querySelectorAll(".popup");xe.forEach(e=>{le(e)});_e(q);let b="";Promise.all([W(),ee()]).then(([e,t])=>{b=t._id,A.textContent=t.name,P.textContent=t.about,T.style.backgroundImage=`url(${t.avatar})`,e.forEach(o=>{R.append(J(o,b,{onPreviewPicture:X,onLikeIcon:j,onDeleteCard:Y,onInfoClick:Q}))})}).catch(()=>{});
